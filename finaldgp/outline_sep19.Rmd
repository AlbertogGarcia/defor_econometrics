---
title: "outline_sep19"
author: "Alberto Garcia"
date: "September 3, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source('quickmontey.R')
source('binary_coeffdist_fcn.R')
source('funcform.R')
source('grid_scapegen.R')
source('grid_sim.R')
source('property_scapegen.R')
source('weightedreg_test.R')
source('property_perturb.R')
source('outcome_comparison.R')

```

Define universal parameters
```{r parameters}
b0 = .05
b1 = -0.1
b2 = -0.2
b3 = .16
std_a = .1
std_v = 0.25
years = 3
nobs = 10000
n = 100


cellsize = 20
ppoints = 200
std_p = .15
```



```{r DIDy, results='hide'}
DID_y <- quickmontey(n, nobs, years, b0, b1, b2, b3, std_a, std_v, "y")
DID_y$plot
```

Above, we see a slight bias in the DID estimates of the ATT when the binary outcome is able to vary between 0 and 1 across periods. This comes from the DID estimand not identifying the ATT with the DGP. 




```{r DIDy_it, results='hide'}
DID_yit <- quickmontey(n, nobs, years, b0, b1, b2, b3, std_a, std_v, "y_it")
DID_yit$plot
```

In the above plot, we drop pixels in the periods after they first become deforested. The DID estimates are still biased here. 


```{r FE, results='hide'}
twowayFE <- binary_coeffdist_fcn(n, nobs, years, b0, b1, b2, b3, std_a, std_v)
twowayFE$plot
```

Above, we address the use of two-way fixed effects and the dropping of observations in the periods after pixels are first observed as deforested.  




```{r functionalforms, results='hide'}
functionalform <- funcform(n, nobs, years, b0, b1, b2, b3, std_a, std_v)
functionalform$plot
```

The above plot shows the DID bias depending on functional form decisions.

```{r outcomes, results='hide'}
outcomes <- outcome_comparison(n, nobs, years, b0, b1, b2, b3, std_a, std_v, cellsize)
outcomes$plot
```

We now aggregate to the grid level. Above, we see the bias introduced by using different outcome variables. (Need a table here to show the different outcomes and will want to cite different papers that use these outcomes. Currently only two outcomes being used in this fuction)


```{r grids, results='hide'}
grid <- grid_sim(n, nobs, years, b0, b1, b2, b3, std_a, std_v, cellsize)
grid$plot
```


Using the outcome from abouve with the smallest amount of bias, we again look at the grid level aggregation to assess this outcome. 



```{r weighting, results='hide'}
weighting <- weightedreg_test(n, nobs, years, b0, b1, b2, b3, std_a, std_v, std_p, cellsize, ppoints)
weighting$plot
```

We now aggregate to the property level to determine whether weighting the regressions by property area is preferable. 


```{r property_perturbations, results='hide'}
perturb <- property_perturb(n, nobs, years, b0, b1, b2, b3, std_a, std_v, std_p, cellsize, ppoints)
perturb$plot
```

In order to compare property level and grid level aggregation, we introduce perturbations at the property level to see if this induces any differences. 






